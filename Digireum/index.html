<html>
<head>
	<meta charset="UTF-8">
	<style type="text/css">
	body{background-color:#000000;}
	@font-face {
		font-family: ArcaMajora3-Bold;
		src: url("font/ArcaMajora3-Bold.otf") format("opentype");
	}
	@font-face {
		font-family: Digivolve;
		src: url("font/Digivolve.otf") format("opentype");
	}
	.layer{
		position:absolute;
		top:50%;
		left:50%;
		transform:translate(-50%, -50%);
		background:url('digivice/Digivice_tri_2.png') no-repeat right center;
		width: 640;
		height: 640;
	}
	.layer .t1 {
		position:absolute;
		top:42%;
		left:50%;
		transform:translate(-50%, -50%);
		background-color:transparent;
		width : 180;
		height : 50;
		font-size : 13pt;
		color: #ffffff;
		font-family: 'Digivolve';
		border-right:0px; border-top:0px; border-left:0px; border-bottom:0px;
		text-align: center;
	}
	.layer .h1 {
		position:absolute;
		top:48%;
		left:50%;
		transform:translate(-50%, -50%);
		background-color:transparent;
		width : 150;
		height : 50;
		font-size : 20pt;
		color: #ffffff;
		font-family: 'Digivolve';
		/*border-right:0px; border-top:0px; border-left:0px; border-bottom:1px solid #FFFFFF;*/
		text-align: center;
	}
	.layer .b1 {
		position:absolute;
		top:57%;
		left:50%;
		transform:translate(-50%, -50%);
		background-color:transparent;
		width : 100;
		height : 50;
		font-size : 13pt;
		color: #ffffff;
		font-family: 'Digivolve';
		border-right:0px; border-top:0px; border-left:0px; border-bottom:0px;/
		text-align: center;
	}
</style>
</head>
<body>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<p>
		<br>
		<div class="layer">
			<!-- <img src="Digivice_tri_2.png" width = "640", height="640", style = "margin-left: auto; margin-right: auto; display: block;"/> -->
			<span class="t1"> your name? </span>
			<input class="h1" type="text" name="text" maxlength="7" onKeyUp="this.value=this.value.toUpperCase();"> 
			<button class="b1" id="button1" type="text" name="text" onclick="setValue()" style="cursor:pointer">Log-in</button>
			<script type="text/javascript" src="index.js"></script>
		</div>
	</p>
</body>
<script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
<!-- script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script -->
<script>
	var contractAddress = '0x42ace1b0651eb0f2711bfcdd22480a6b674392b6';
	var digireumContract
	var digireum
	window.addEventListener('load', function() {
  // Checking if Web3 has been injected by the browser (Mist/MetaMask)
  if (typeof web3 !== 'undefined') {
    // Use Mist/MetaMask's provider
    window.web3 = new Web3(web3.currentProvider);
} else {
	console.log('No web3? You should consider trying MetaMask!')
    // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
    window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}
  // Now you can start your app & access web3 freely:
  startApp();
});
	function startApp() {
		digireumContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"name","type":"string"}],"name":"login","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"getRandomTamer","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"num","type":"uint256"}],"name":"initializer","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"in_name","type":"string"}],"name":"get","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"say","type":"string"}],"name":"saying","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getDigimonNum","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]);
		digireum = digireumContract.at(contractAddress);
	}
	function setValue() {
		var newValue = $(".layer .h1").val();
		var txid;
		digireum.get(newValue, function(err, res){
			if (!err){
				if(res.c[0] == 1){
					digireum.login.sendTransaction(newValue, function(err, res){
						if(!err)console.log(res);
						txid = res;
					});

					var filter = web3.eth.filter('latest');
					filter.watch(function(e, r){
						web3.eth.getTransaction(txid, function(e, r){
							if (r!=null && r.blockNumber > 0){
								alert("NEW TAMER LOGGED.");
								filter.stopWatching();
							}
						});
					});

				} else if(res.c[0] == 2) {
					alert("IT'S NOT YOUR NAME.");
				} else {
					alert("LOGGED.");
				}
				console.log(res);
			}
		});
	}
</script>
</html>